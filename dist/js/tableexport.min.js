/*!
 * TableExport.js 4.0.0-rc.1 (https://www.travismclarke.com)
 * Copyright 2017 Travis Clarke
 * Licensed under the MIT license
 */
!function(t,e){"function"==typeof define&&define.amd?define(["exports","jquery","blobjs","file-saverjs","xlsx-js"],e):"object"==typeof exports&&"string"!=typeof exports.nodeName?e(exports,require("jquery"),require("blobjs"),require("file-saverjs"),require("xlsx-js")):e(t,t.jQuery,t.Blob,t.saveAs,t.XLSX)}(this||window,function(t,e,r,n,o){"use strict";function s(){for(var t=arguments,e=1;e<t.length;e++)for(var r in t[e])t[e].hasOwnProperty(r)&&(t[0][r]=t[e][r]);return t[0]}function i(t){return t instanceof NodeList||e&&t instanceof e?[].slice.call(t):[].concat(t)}function a(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.cls)}function l(t,e,r){var n={};return t?(n.bootstrapClass=t[0]+" ",n.bootstrapTheme=t[1]+" ",n.bootstrapSpacing=t[2]+" "):(n.bootstrapClass=r+" ",n.bootstrapTheme="",n.bootstrapSpacing=""),n}var u=function(t,e,r){var n=this;n.settings=r?e:s({},n.defaults,e),n.selectors=i(t);var a=n.settings;a.ignoreRows=a.ignoreRows instanceof Array?a.ignoreRows:[a.ignoreRows],a.ignoreCols=a.ignoreCols instanceof Array?a.ignoreCols:[a.ignoreCols],a.ignoreCSS=n.ignoreCSS instanceof Array?n.ignoreCSS.join(", "):n.ignoreCSS,a.emptyCSS=n.emptyCSS instanceof Array?n.emptyCSS.join(", "):n.emptyCSS,a.formatValue=n.formatValue.bind(this,a.trimWhitespace),a.bootstrapSettings=l(n.bootstrap,n.bootstrapConfig,n.defaultButton);var u={};n.getExportData=function(){return u},n.selectors.forEach(function(t){var e={},s=t.querySelectorAll("caption:not(.head)");r&&s.parentNode.removeChild(s),e.rows=i(t.querySelectorAll("tbody > tr")),e.rows=a.headers?i(t.querySelectorAll("thead > tr")).concat(e.rows):e.rows,e.rows=a.footers?e.rows.concat(i(t.querySelectorAll("tfoot > tr"))):e.rows,e.thAdj=a.headers?t.querySelectorAll("thead > tr").length:0,e.filename="id"===a.filename?t.getAttribute("id")?t.getAttribute("id"):n.defaultFilename:a.filename?a.filename:n.defaultFilename,e.uuid=f(t),e.checkCaption=function(e){var r=t.querySelectorAll("caption:not(.head)");r.length?r[0].appendChild(e):(r=document.createElement("caption"),r.className=a.bootstrapSettings.bootstrapSpacing+a.position,r.appendChild(e),t.insertBefore(r,t.firstChild))},e.setExportData=function(){return function(t){var r=p.getInstance().getItem(t),n=t.substring(t.indexOf("-")+1);u[e.uuid]=u[e.uuid]||{},u[e.uuid][n]=JSON.parse(r)}}(),a.formats.forEach(function(t){!(!o||"xls"!==t)&&(t="xlsm"),!o&&"xlsx"===t&&(t=null),t&&e.setExportData(n.exporters[t].call(n,e))})});var c=document.querySelectorAll("button[tableexport-id]");return m(c,"click",n.downloadHandler,n),n};u.prototype={version:"4.0.0-rc.1",defaults:{headers:!0,footers:!0,formats:["xls","csv","txt"],filename:"id",bootstrap:!1,exportButtons:!0,position:"bottom",ignoreRows:null,ignoreCols:null,trimWhitespace:!0},charset:"charset=utf-8",defaultFilename:"myDownload",defaultButton:"button-default",ignoreCSS:"tableexport-ignore",emptyCSS:"tableexport-empty",bootstrapConfig:["btn","btn-default","btn-toolbar"],rowDel:"\r\n",entityMap:{"&":"&#38;","<":"&#60;",">":"&#62;","'":"&#39;","/":"&#47;"},xlsx:{defaultClass:"xlsx",buttonContent:"Export to xlsx",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",fileExtension:".xlsx"},xls:{defaultClass:"xls",buttonContent:"Export to xls",separator:"\t",mimeType:"application/vnd.ms-excel",fileExtension:".xls"},csv:{defaultClass:"csv",buttonContent:"Export to csv",separator:",",mimeType:"text/csv",fileExtension:".csv"},txt:{defaultClass:"txt",buttonContent:"Export to txt",separator:"  ",mimeType:"text/plain",fileExtension:".txt"},types:{string:{defaultClass:"tableexport-string"},number:{defaultClass:"tableexport-number",assert:function(t){return!isNaN(t.replace(/,/g,""))}},"boolean":{defaultClass:"tableexport-boolean",assert:function(t){return"true"===t.toLowerCase()||"false"===t.toLowerCase()}},date:{defaultClass:"tableexport-date",assert:function(t){return!isNaN(Date.parse(t))}}},exporters:{xlsx:function(t){var e=this,r=e.settings,n={},o=i(t.rows).map(function(o,s){if(!~r.ignoreRows.indexOf(s-t.thAdj)&&!a(o,r.ignoreCSS)){var l=o.querySelectorAll("th, td");return i(l).map(function(t,o){if(!~r.ignoreCols.indexOf(o)&&!a(t,r.ignoreCSS)){if(a(t,r.emptyCSS))return" ";if(t.hasAttribute("colspan")&&(n[s]=n[s]||{},n[s][o+1]=t.getAttribute("colspan")-1),t.hasAttribute("rowspan"))for(var i=1;i<t.getAttribute("rowspan");i++)n[s+i]=n[s+i]||{},n[s+i][o]=1;if(n[s]){for(var l=o+1,u=0,p=0,i=0;i<=Math.max.apply(Math,Object.keys(n[s]))&&(n[s][i]?u=p>=o?u+n[s][i]:u:p++,p!==l);i++);return new Array(u).concat({v:r.formatValue(t.textContent),t:e.getType(t.className)})}return{v:r.formatValue(t.textContent),t:e.getType(t.className)}}}).filter(function(t){return t})}}).map(function(t){return t&&[].concat.apply([],t)}).filter(function(t){return t}),s=u.prototype.escapeHtml(JSON.stringify({data:o,filename:t.filename,mimeType:u.prototype.xlsx.mimeType,fileExtension:u.prototype.xlsx.fileExtension})),l=u.prototype.xlsx.buttonContent,f=u.prototype.xlsx.defaultClass,m=c({uuid:t.uuid,type:"xlsx"}),x=r.exportButtons&&u.prototype.createObjButton(m,s,l,f,r.bootstrapSettings);return x&&t.checkCaption(x),p.getInstance().setItem(m,s,!0),m},xlsm:function(t){var e=this,r=e.settings,n={},o=i(t.rows).map(function(o,s){if(!~r.ignoreRows.indexOf(s-t.thAdj)&&!a(o,r.ignoreCSS)){var l=o.querySelectorAll("th, td");return i(l).map(function(t,o){if(!~r.ignoreCols.indexOf(o)&&!a(t,r.ignoreCSS)){if(a(t,r.emptyCSS))return" ";if(t.hasAttribute("colspan")&&(n[s]=n[s]||{},n[s][o+1]=t.getAttribute("colspan")-1),t.hasAttribute("rowspan"))for(var i=1;i<t.getAttribute("rowspan");i++)n[s+i]=n[s+i]||{},n[s+i][o]=1;if(n[s]){for(var l=o+1,u=0,p=0,i=0;i<=Math.max.apply(Math,Object.keys(n[s]))&&(n[s][i]?u=p>=o?u+n[s][i]:u:p++,p!==l);i++);return new Array(u).concat({v:r.formatValue(t.textContent),t:e.getType(t.className)})}return{v:r.formatValue(t.textContent),t:e.getType(t.className)}}}).filter(function(t){return t})}}).map(function(t){return t&&[].concat.apply([],t)}).filter(function(t){return t}),s=u.prototype.escapeHtml(JSON.stringify({data:o,filename:t.filename,mimeType:u.prototype.xls.mimeType,fileExtension:u.prototype.xls.fileExtension})),l=u.prototype.xls.buttonContent,f=u.prototype.xls.defaultClass,m=c({uuid:t.uuid,type:"xls"}),x=r.exportButtons&&u.prototype.createObjButton(m,s,l,f,r.bootstrapSettings);return x&&t.checkCaption(x),p.getInstance().setItem(m,s,!0),m},xls:function(t){var e=this,r=e.settings,n=u.prototype.xls.separator,o=i(t.rows).map(function(o,s){if(!~r.ignoreRows.indexOf(s-t.thAdj)&&!a(o,r.ignoreCSS)){var l=o.querySelectorAll("th, td");return i(l).map(function(t,n){if(!~r.ignoreCols.indexOf(n)&&!a(t,r.ignoreCSS))return a(t,r.emptyCSS)?" ":{v:r.formatValue(t.textContent),t:e.getType(t.className)}}).join(n)}}).join(e).map(function(t){return[].concat.apply([],t)}),s=u.prototype.escapeHtml(JSON.stringify({data:o,filename:t.filename,mimeType:u.prototype.xls.mimeType,fileExtension:u.prototype.xls.fileExtension})),l=u.prototype.xls.buttonContent,f=u.prototype.xls.defaultClass,m=c({uuid:t.uuid,type:"xls"}),x=r.exportButtons&&u.prototype.createObjButton(m,s,l,f,r.bootstrapSettings);return x&&t.checkCaption(x),p.getInstance().setItem(m,s,!0),m},csv:function(t){var e=this,r=e.settings,n=u.prototype.csv.separator,o=i(t.rows).map(function(e,o){if(!~r.ignoreRows.indexOf(o-t.thAdj)&&!a(e,r.ignoreCSS)){var s=e.querySelectorAll("th, td");return i(s).map(function(t,e){if(!~r.ignoreCols.indexOf(e)&&!a(t,r.ignoreCSS))return a(t,r.emptyCSS)?" ":'"'+r.formatValue(t.textContent.replace(/"/g,'""'))+'"'}).join(n)}}).join(e.rowDel),s=u.prototype.escapeHtml(JSON.stringify({data:o,filename:t.filename,mimeType:u.prototype.csv.mimeType,fileExtension:u.prototype.csv.fileExtension})),l=u.prototype.csv.buttonContent,f=u.prototype.csv.defaultClass,m=c({uuid:t.uuid,type:"csv"}),x=r.exportButtons&&u.prototype.createObjButton(m,s,l,f,r.bootstrapSettings);return x&&t.checkCaption(x),p.getInstance().setItem(m,s,!0),m},txt:function(t){var e=this,r=e.settings,n=u.prototype.txt.separator,o=i(t.rows).map(function(e,o){if(!~r.ignoreRows.indexOf(o-t.thAdj)&&!a(e,r.ignoreCSS)){var s=e.querySelectorAll("th, td");return i(s).map(function(t,e){if(!~r.ignoreCols.indexOf(e)&&!a(t,r.ignoreCSS))return a(t,r.emptyCSS)?" ":r.formatValue(t.textContent)}).join(n)}}).join(e.rowDel),s=u.prototype.escapeHtml(JSON.stringify({data:o,filename:t.filename,mimeType:u.prototype.txt.mimeType,fileExtension:u.prototype.txt.fileExtension})),l=u.prototype.txt.buttonContent,f=u.prototype.txt.defaultClass,m=c({uuid:t.uuid,type:"txt"}),x=r.exportButtons&&u.prototype.createObjButton(m,s,l,f,r.bootstrapSettings);return x&&t.checkCaption(x),p.getInstance().setItem(m,s,!0),m}},createObjButton:function(t,e,r,n,o){var s=document.createElement("button");return s.setAttribute("tableexport-id",t),s.className=o.bootstrapClass+o.bootstrapTheme+n,s.textContent=r,s},escapeHtml:function(t){return String(t).replace(/[&<>'\/]/g,function(t){return u.prototype.entityMap[t]})},formatValue:function(t,e){return t?e.trim():e},getType:function(t){if(!t)return"";var e=u.prototype.types;return~t.indexOf(e.string.defaultClass)?"s":~t.indexOf(e.number.defaultClass)?"n":~t.indexOf(e["boolean"].defaultClass)?"b":~t.indexOf(e.date.defaultClass)?"d":""},dateNum:function(t,e){e&&(t+=1462);var r=Date.parse(t);return(r-new Date(Date.UTC(1899,11,30)))/864e5},createSheet:function(t){for(var e={},r={s:{c:1e7,r:1e7},e:{c:0,r:0}},n=u.prototype.types,s=0;s!==t.length;++s)for(var i=0;i!==t[s].length;++i){r.s.r>s&&(r.s.r=s),r.s.c>i&&(r.s.c=i),r.e.r<s&&(r.e.r=s),r.e.c<i&&(r.e.c=i);var a=t[s][i];if(a&&a.v){var l=o.utils.encode_cell({c:i,r:s});a.t||(n.number.assert(a.v)?a.t="n":n["boolean"].assert(a.v)?a.t="b":n.date.assert(a.v)?a.t="d":a.t="s"),"d"===a.t&&(a.t="n",a.z=o.SSF._table[14],a.v=this.dateNum(a.v)),e[l]=a}}return r.s.c<1e7&&(e["!ref"]=o.utils.encode_range(r)),e},downloadHandler:function(t){var e=t.target,r=JSON.parse(p.getInstance().getItem(e.getAttribute("tableexport-id"))),n=r.data,o=r.filename,s=r.mimeType,i=r.fileExtension;this.export2file(n,s,o,i)},Workbook:function(){this.SheetNames=[],this.Sheets={}},string2ArrayBuffer:function(t){for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),n=0;n!==t.length;++n)r[n]=255&t.charCodeAt(n);return e},export2file:function(t,e,s,i){if(o&&".xls"===i.substr(0,4)){var a=new this.Workbook,l=this.createSheet(t);a.SheetNames.push(s),a.Sheets[s]=l;var u={bookType:i.substr(1,3)+(i.substr(4)||"m"),bookSST:!1,type:"binary"},p=o.write(a,u);t=this.string2ArrayBuffer(p)}n(new r([t],{type:e+";"+this.charset}),s+i,!0)},update:function(t){},reset:function(){},remove:function(){},LocalStorage:function(){this.type="localStorage",this.store=t[this.type],this.namespace="te-",this.getKey=function(t){return this.namespace+t},this.setItem=function(t,e,r){var n=this.getKey(t);if(!this.exists(n)||r)return"string"!=typeof e?this.error('"value" must be a string'):this.store.setItem(n,e)},this.getItem=function(t){var e=this.getKey(t);return this.store.getItem(e)},this.exists=function(t){var e=this.getKey(t);return null!==this.store.getItem(e)},this.removeItem=function(t){var e=this.getKey(t);return this.store.removeItem(e)},this.error=function(t){return new Error("error:",t)}}};var p=u.prototype.LocalStorage;p.getInstance=function(){return p._instance=null,function(){return p._instance||(p._instance=new p),p._instance}}();var f=function(){var t=0;return function(e){return e.id||(e.id="tableexport-"+ ++t),e.id}}(),c=function(){var t,e,r=0;return function(n){var o=n.type;if(n=JSON.stringify(n),0===n.length)return r;for(t=0;t<n.length;t++)e=n.charCodeAt(t),r=(r<<5)-r+e,r|=0;return r.toString(16).substring(1)+"-"+o}}(),m=function(){var t=null;return function(e,r,n,o){for(var s=n.bind(o),i=0;i<e.length;++i)t&&e[i].removeEventListener(r,t,!1),e[i].addEventListener(r,s,!1);t=s}}();if(e){e.fn.tableExport=function(t,e){return new u(this,t,e)};for(var x in u.prototype)e.fn.tableExport[x]=u.prototype[x]}return t["default"]=t.TableExport=u});